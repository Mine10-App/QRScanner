<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Accepted Requests</title>
<link rel="stylesheet" href="style.css">
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background-color: #f2f2f2; }
  button { padding: 4px 8px; margin: 2px; }
</style>
</head>
<body>
<h2>Accepted Requests</h2>

<div class="filters">
  <label>Date: <input type="date" id="filterDate"></label>
  <label>Request Staff: <input type="text" id="filterStaff" placeholder="Name"></label>
  <button onclick="loadAcceptedRequests()">Apply Filter</button>
</div>

<table>
  <thead>
    <tr>
      <th>Request Staff</th>
      <th>Recipient</th>
      <th>Date</th>
      <th>Duty Time</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="requestsTable">
    <tr><td colspan="6">Loading...</td></tr>
  </tbody>
</table>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="sca.js"></script> <!-- Firebase config -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script>
  const db = firebase.firestore();

  function loadAcceptedRequests() {
    const tableBody = document.getElementById("requestsTable");
    const filterDate = document.getElementById("filterDate").value;
    const filterStaff = document.getElementById("filterStaff").value.toLowerCase();

    // Get all accepted requests
    db.collection("dutyRequests").where("status", "==", "accepted").get()
      .then(snapshot => {
        let rows = "";

        snapshot.forEach(doc => {
          const data = doc.data();
          const requestDate = data.date;
          const staffName = data.requestedStaff.toLowerCase();

          // Apply filters if any
          if ((filterDate && filterDate !== requestDate) ||
              (filterStaff && !staffName.includes(filterStaff))) return;

          rows += `
            <tr>
              <td>${data.requestedStaff}</td>
              <td>${data.recipient}</td>
              <td>${data.date}</td>
              <td>${data.dutyTime}</td>
              <td>${data.status}</td>
              <td>
                ${data.applied ? 'Applied' : `<button onclick="markApplied('${doc.id}')">Apply</button>`}
                <button onclick="deleteRequest('${doc.id}')" ${data.applied ? 'disabled' : ''}>Delete</button>
              </td>
            </tr>
          `;
        });

        tableBody.innerHTML = rows || "<tr><td colspan='6'>No accepted requests found.</td></tr>";
      })
      .catch(err => {
        console.error(err);
        tableBody.innerHTML = "<tr><td colspan='6'>Error loading requests.</td></tr>";
      });
  }

  function markApplied(id) {
    db.collection("dutyRequests").doc(id).update({ applied: true })
      .then(() => loadAcceptedRequests());
  }

  function deleteRequest(id) {
    db.collection("dutyRequests").doc(id).delete()
      .then(() => loadAcceptedRequests());
  }

  loadAcceptedRequests(); // Initial load
</script>
</body>
</html>
