<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Duty Change Request</title>
<link rel="stylesheet" href="style.css">
<style>
  .small-btn { padding: 4px 8px; font-size: 0.8rem; margin-right: 5px; }
</style>
</head>
<body>
<div class="form-container">
  <h2>Duty Change Request</h2>

  <div class="top-buttons">
    <button class="small-btn" onclick="goToDashboard()">Dashboard</button>
    <button class="small-btn" onclick="logout()">Logout</button>
  </div>

  <form id="dutyChangeForm">
    <div class="form-row">
      <label for="requestedStaff">Requested Staff:</label>
      <input type="text" id="requestedStaff" readonly>
    </div>

    <div class="form-row">
      <label for="recipient">Recipient Staff:</label>
      <select id="recipient" required>
        <option value="">--Select--</option>
        <option value="Mohamed Mujahid">Mohamed Mujahid</option>
        <option value="Magrib Ibrahim">Magrib Ibrahim</option>
        <option value="Ruhushath Ahmed">Ruhushath Ahmed</option>
        <option value="Moahmed Jeezan">Moahmed Jeezan</option>
        <option value="Aishath Aroosha">Aishath Aroosha</option>
      </select>
    </div>

    <div class="form-row">
      <label for="date">Date:</label>
      <input type="date" id="date" required>
    </div>

    <div class="form-row">
      <label for="dutyTime">Duty Time:</label>
      <input type="time" id="dutyTime" required>
    </div>

    <button type="submit" class="small-btn">Send Request</button>
  </form>

  <div id="confirmation" style="margin-top:15px; color:green;"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="sca.js"></script>

<script>
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const currentUser = localStorage.getItem("currentUser");
if (!currentUser) {
  alert("Please login first!");
  window.location.href = "login.html";
} else {
  document.getElementById("requestedStaff").value = currentUser;
}

function goToDashboard() {
  window.location.href = "dashboard.html";
}

function logout() {
  localStorage.removeItem("currentUser");
  localStorage.removeItem("currentRCNo");
  window.location.href = "login.html";
}

// Check half-month limit
function canSendRequest(requests, currentUser, requestDate) {
    const date = new Date(requestDate);
    const day = date.getDate();
    const month = date.getMonth();
    const year = date.getFullYear();
    const half = day <= 15 ? 1 : 2;

    const userRequestsThisHalf = requests.filter(req => {
        const reqDate = new Date(req.date);
        const reqHalf = reqDate.getDate() <= 15 ? 1 : 2;
        return req.requestedStaff === current
