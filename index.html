<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>QR & Barcode Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    button { padding: 12px; margin: 10px; font-size: 16px; border-radius: 8px; }
    #result { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
    ul { list-style: none; padding: 0; }
    li { padding: 10px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; }
    .deleteBtn { background: red; color: white; border: none; padding: 5px 10px; border-radius: 5px; }
  </style>
</head>
<body>
  <h2>ðŸ“· QR & Barcode Scanner</h2>
  <button onclick="scanCode()">Scan Now</button>
  <button onclick="loadData()">Refresh List</button>
  
  <div id="result">Scan a code to begin...</div>
  <h3>Scanned Data</h3>
  <ul id="dataList"></ul>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // ðŸ”¹ Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyC9FuNjWn8Up4JyjYbABEF2aNjO2bSXdfM",
      authDomain: "qr-scanner-4458e.firebaseapp.com",
      projectId: "qr-scanner-4458e",
      storageBucket: "qr-scanner-4458e.firebasestorage.app",
      messagingSenderId: "1099262112748",
      appId: "1:1099262112748:web:a18f206bcf893c894546c9",
      measurementId: "G-15WXNEPKS9"
    };


    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ðŸ”¹ Scan QR / Barcode
    function scanCode() {
      cordova.plugins.barcodeScanner.scan(
        async function (result) {
          if (!result.cancelled) {
            document.getElementById("result").innerText = "Scanned: " + result.text;
            
            // Save to Firebase
            await db.collection("scans").add({
              text: result.text,
              format: result.format,
              time: new Date().toISOString()
            });
            loadData();
          }
        },
        function (error) {
          alert("Scanning failed: " + error);
        },
        {
          preferFrontCamera: false,
          showFlipCameraButton: true,
          showTorchButton: true,
          prompt: "Place a QR/Barcode inside the scan area",
          formats: "QR_CODE,PDF_417,CODE_39,CODE_128,EAN_13,EAN_8,UPC_A,UPC_E",
          orientation: "portrait"
        }
      );
    }

    // ðŸ”¹ Load Data from Firebase
    async function loadData() {
      const snapshot = await db.collection("scans").orderBy("time", "desc").get();
      const list = document.getElementById("dataList");
      list.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement("li");
        li.innerHTML = `
          <span>${data.text} <small>(${data.format})</small></span>
          <button class="deleteBtn" onclick="deleteData('${doc.id}')">Delete</button>
        `;
        list.appendChild(li);
      });
    }

    // ðŸ”¹ Delete a record
    async function deleteData(id) {
      await db.collection("scans").doc(id).delete();
      loadData();
    }

    // Load on start
    document.addEventListener("deviceready", loadData, false);
  </script>
</body>
</html>

