<!DOCTYPE html>
<html>
<head>
  <title>Room Token Control</title>
  <style>
    body { font-family: Arial; margin: 50px; }
    input[type=number] { width: 60px; margin-left: 5px; }
    button { margin-left: 10px; }
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <h1>Room Token Control</h1>

  <div>
    <label>Enter Room Number: </label>
    <input type="number" id="roomInput" min="1" max="20" />
    <button onclick="setRoom()">Confirm Room</button>
  </div>

  <div id="controlPanel" style="display:none; margin-top:30px;">
    <h2 id="roomLabel"></h2>
    <button onclick="nextToken()">Next Token</button>
    <button onclick="resetToken()">Reset Token</button>
    <input type="number" id="manualToken" placeholder="Enter token"/>
    <button onclick="setToken()">Set Token</button>
    <p id="currentToken">Current Token: 0</p>
  </div>

  <script>
    // -------------------------------
    // 1️⃣ Firebase Config
    // -------------------------------
   const firebaseConfig = {
            apiKey: "AIzaSyC9FuNjWn8Up4JyjYbABEF2aNjO2bSXdfM",
            authDomain: "qr-scanner-4458e.firebaseapp.com",
            projectId: "qr-scanner-4458e",
            storageBucket: "qr-scanner-4458e.firebasestorage.app",
            messagingSenderId: "1099262112748",
            appId: "1:1099262112748:web:a18f206bcf893c894546c9",
            measurementId: "G-15WXNEPKS9"
        };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let roomNumber = null;
    let tokenRef = null;

    // -------------------------------
    // 2️⃣ Confirm Room
    // -------------------------------
    function setRoom() {
      const roomInput = parseInt(document.getElementById('roomInput').value);
      if (isNaN(roomInput) || roomInput < 1) {
        alert("Please enter a valid room number.");
        return;
      }
      roomNumber = roomInput;
      tokenRef = db.ref('tokens/' + roomNumber);
      document.getElementById('roomLabel').textContent = `Room ${roomNumber}`;
      document.getElementById('controlPanel').style.display = 'block';
      document.getElementById('roomInput').disabled = true;

      // Listen for token changes for this room
      tokenRef.on('value', snapshot => {
        const val = snapshot.val() || 0;
        document.getElementById('currentToken').textContent = 'Current Token: ' + val;
      });
    }

    // -------------------------------
    // 3️⃣ Token Controls
    // -------------------------------
    function nextToken() {
      tokenRef.transaction(current => (current || 0) + 1);
    }

    function resetToken() {
      tokenRef.set(0);
    }

    function setToken() {
      const val = parseInt(document.getElementById('manualToken').value);
      if (!isNaN(val)) {
        tokenRef.set(val);
      }
    }
  </script>
</body>
</html>
