<!DOCTYPE html>
<html>
<head>
  <title>Staff Token Control</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    .room { margin-bottom: 20px; }
    input[type=number] { width: 60px; }
    button { margin-left: 5px; }
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <h1>Staff Token Control</h1>
  <div id="roomsContainer"></div>

  <script>
    // -------------------------------
    // 1️⃣ Firebase Config
    // -------------------------------
   const firebaseConfig = {
            apiKey: "AIzaSyC9FuNjWn8Up4JyjYbABEF2aNjO2bSXdfM",
            authDomain: "qr-scanner-4458e.firebaseapp.com",
            projectId: "qr-scanner-4458e",
            storageBucket: "qr-scanner-4458e.firebasestorage.app",
            messagingSenderId: "1099262112748",
            appId: "1:1099262112748:web:a18f206bcf893c894546c9",
            measurementId: "G-15WXNEPKS9"
        };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const tokensRef = db.ref('tokens');

    // -------------------------------
    // 2️⃣ Setup Rooms
    // -------------------------------
    const rooms = [1,2,3,4,5,6,7,8,9,10];
    const container = document.getElementById('roomsContainer');

    rooms.forEach(room => {
      const div = document.createElement('div');
      div.classList.add('room');
      div.innerHTML = `
        <strong>Room ${room}</strong>
        <button onclick="nextToken(${room})">Next Token</button>
        <button onclick="resetToken(${room})">Reset</button>
        <input type="number" id="manual-${room}" placeholder="Enter token"/>
        <button onclick="setToken(${room})">Set Token</button>
        <span id="current-${room}">Token: 0</span>
      `;
      container.appendChild(div);
    });

    // -------------------------------
    // 3️⃣ Functions
    // -------------------------------
    function nextToken(room) {
      const ref = db.ref('tokens/' + room);
      ref.transaction(current => (current || 0) + 1);
    }

    function resetToken(room) {
      db.ref('tokens/' + room).set(0);
    }

    function setToken(room) {
      const val = parseInt(document.getElementById('manual-' + room).value);
      if (!isNaN(val)) {
        db.ref('tokens/' + room).set(val);
      }
    }

    // -------------------------------
    // 4️⃣ Live token updates on staff panel
    // -------------------------------
    tokensRef.on('value', snapshot => {
      const data = snapshot.val() || {};
      rooms.forEach(room => {
        document.getElementById('current-' + room).textContent = 'Token: ' + (data[room] || 0);
      });
    });
  </script>
</body>
</html>
