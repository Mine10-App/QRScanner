<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="form-container">
  <h2>Welcome, <span id="userName"></span></h2>

  <div class="top-buttons">
    <button onclick="goToDutyChange()">Request Duty Change</button>
    <button onclick="logout()">Logout</button>
    <a href="change-password.html">Change Password</a>
  </div>

  <h3>Requests Assigned To You</h3>
  <div id="incomingRequests"><p>Loading...</p></div>

  <h3>Requests Sent By You</h3>
  <div id="sentRequests"><p>Loading...</p></div>
</div>

<script src="script.js"></script>
<script>
  // Get current user
  const currentUser = localStorage.getItem("currentUser");
  const currentUsername = localStorage.getItem("currentUsername");

  if (!currentUser) {
    alert("Please login first!");
    window.location.href = "login.html";
  } else {
    document.getElementById("userName").innerText = currentUser;
  }

  function goToDutyChange() {
    window.location.href = "dutychange.html";
  }

  // ===== Sample Requests =====
  const dutyRequests = [
    { id: "1", requestedStaff: "mohamed", recipient: "mariyam", date: "2025-09-11", dutyTime: "Morning", status: "pending" },
    { id: "2", requestedStaff: "mariyam", recipient: "mohamed", date: "2025-09-12", dutyTime: "Evening", status: "accepted" },
  ];

  function loadRequests() {
    const incomingContainer = document.getElementById("incomingRequests");
    const sentContainer = document.getElementById("sentRequests");

    let incomingHTML = "";
    let sentHTML = "";

    dutyRequests.forEach(req => {
      if(req.recipient === currentUsername){
        incomingHTML += `
          <div class="request-card">
            <p><strong>From:</strong> ${req.requestedStaff}</p>
            <p><strong>Date:</strong> ${req.date}</p>
            <p><strong>Duty Time:</strong> ${req.dutyTime}</p>
            <p><strong>Status:</strong> ${req.status}</p>
            ${req.status === "pending" ? `<button onclick="acceptRequest('${req.id}')">Accept</button>
            <button onclick="rejectRequest('${req.id}')">Reject</button>` : ""}
            <hr>
          </div>`;
      }

      if(req.requestedStaff === currentUsername){
        sentHTML += `
          <div class="request-card">
            <p><strong>To:</strong> ${req.recipient}</p>
            <p><strong>Date:</strong> ${req.date}</p>
            <p><strong>Duty Time:</strong> ${req.dutyTime}</p>
            <p><strong>Status:</strong> ${req.status}</p>
            <hr>
          </div>`;
      }
    });

    incomingContainer.innerHTML = incomingHTML || "<p>No pending requests.</p>";
    sentContainer.innerHTML = sentHTML || "<p>No requests sent.</p>";
  }

  function acceptRequest(id){
    const req = dutyRequests.find(r => r.id === id);
    if(req) req.status = "accepted";
    loadRequests();
  }

  function rejectRequest(id){
    const req = dutyRequests.find(r => r.id === id);
    if(req) req.status = "rejected";
    loadRequests();
  }

  loadRequests();
</script>
</body>
</html>
