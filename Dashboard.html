<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="form-container">
  <h2>Welcome, <span id="userName"></span></h2>

 <div class="top-buttons">
  <button class="ribbon-button" onclick="goToDutyChange()">Request Duty Change</button>
  <button class="ribbon-button" onclick="logout()">Logout</button>
</div>

  

  <h3>Pending Duty Change Requests</h3>
  <div id="requestList">
    <!-- Requests will appear here -->
  </div>
</div>

<script>
const currentUser = localStorage.getItem("currentUser");

if(!currentUser){
  window.location.href = "index.html";
} else {
  document.getElementById("userName").innerText = currentUser;
  document.getElementById("otpField").value = localStorage.getItem(`otp_${currentUser}`) || "No OTP assigned";
}

// Navigate to Duty Change Page
function goToDutyChange(){
  window.location.href = "dutychange.html";
}

// Logout
function logout(){
  localStorage.removeItem("currentUser");
  localStorage.removeItem("currentRCNo");
  window.location.href = "login.html";
}

// Load pending requests for this staff
function loadRequests(){
  const allRequests = JSON.parse(localStorage.getItem("dutyRequests") || "[]");
  const myRequests = allRequests.filter(r => r.recipient === currentUser && r.status === "pending");

  const container = document.getElementById("requestList");
  container.innerHTML = "";

  if(myRequests.length === 0){
    container.innerHTML = "<p>No pending requests.</p>";
    return;
  }

  myRequests.forEach((r, index) => {
    const div = document.createElement("div");
    div.className = "request-card";
    div.innerHTML = `
      <p><strong>From:</strong> ${r.requestedStaff}</p>
      <p><strong>Date:</strong> ${r.date}</p>
      <p><strong>Duty Time:</strong> ${r.dutyTime}</p>
      <button onclick="acceptRequest(${index})">Accept</button>
      <button onclick="rejectRequest(${index})">Reject</button>
      <hr>
    `;
    container.appendChild(div);
  });
}

// Accept/Reject functions
function acceptRequest(index){
  const allRequests = JSON.parse(localStorage.getItem("dutyRequests") || "[]");
  const myRequests = allRequests.filter(r => r.recipient === currentUser && r.status === "pending");
  const req = myRequests[index];
  const reqIndex = allRequests.findIndex(r => r.requestedStaff === req.requestedStaff && r.recipient === req.recipient && r.date === req.date);
  allRequests[reqIndex].status = "accepted";
  localStorage.setItem("dutyRequests", JSON.stringify(allRequests));
  alert("Request accepted!");
  loadRequests();
}

function rejectRequest(index){
  const allRequests = JSON.parse(localStorage.getItem("dutyRequests") || "[]");
  const myRequests = allRequests.filter(r => r.recipient === currentUser && r.status === "pending");
  const req = myRequests[index];
  const reqIndex = allRequests.findIndex(r => r.requestedStaff === req.requestedStaff && r.recipient === req.recipient && r.date === req.date);
  allRequests[reqIndex].status = "rejected";
  localStorage.setItem("dutyRequests", JSON.stringify(allRequests));
  alert("Request rejected!");
  loadRequests();
}

// Load requests on page load
loadRequests();
</script>
</body>
</html>
