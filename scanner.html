<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scan QR / Barcode via Photo</title>
  <script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>
</head>
<body style="text-align:center; font-family:sans-serif;">

<h2>Scan QR / Barcode</h2>

<!-- Hidden file input to open camera -->
<input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none;">

<!-- Button to trigger camera -->
<button onclick="document.getElementById('cameraInput').click()" 
        style="padding:15px 25px; font-size:18px;">
  Open Camera
</button>

<canvas id="canvas" style="display:none;"></canvas>
<p id="result" style="font-size:18px; color:green;"></p>

<script>
const input = document.getElementById('cameraInput');
const canvas = document.getElementById('canvas');
const resultElement = document.getElementById('result');

input.addEventListener('change', async (event) => {
  if (event.target.files.length === 0) return;

  const file = event.target.files[0];
  const img = new Image();
  img.src = URL.createObjectURL(file);

  img.onload = () => {
    // Draw the image to a canvas
    canvas.width = img.width;
    canvas.height = img.height;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0);

    // Get image data for QR code reading
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

    // Scan QR code
    const code = jsQR(imageData.data, imageData.width, imageData.height);
    if (code) {
      resultElement.textContent = "Scanned: " + code.data;
    } else {
      resultElement.textContent = "No QR/Barcode found. Try again!";
    }
  };
});
</script>

</body>
</html>
