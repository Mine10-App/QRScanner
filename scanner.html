<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR & Barcode Scanner</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  #scanner { 
    width: 100%; 
    max-width: 500px; 
    margin: auto;
    overflow: hidden;
    position: relative;
  }
  #scanner video {
    width: 100%;
    transform-origin: center center;
    transition: transform 0.3s ease;
  }
  #scans { margin-top: 20px; }
  .zoom-controls {
    position: absolute;
    bottom: 10px;
    right: 10px;
    z-index: 100;
    display: flex;
    gap: 5px;
  }
  .zoom-btn {
    background: rgba(0,0,0,0.5);
    color: white;
    border: none;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    font-size: 16px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h2>QR & Barcode Scanner</h2>

<div id="scanner">
  <div class="zoom-controls">
    <button class="zoom-btn" id="zoom-out">-</button>
    <button class="zoom-btn" id="zoom-in">+</button>
  </div>
</div>

<div id="scans">
  <h3>Scanned Values:</h3>
  <ul id="scan-list"></ul>
</div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyC9FuNjWn8Up4JyjYbABEF2aNjO2bSXdfM",
    authDomain: "qr-scanner-4458e.firebaseapp.com",
    projectId: "qr-scanner-4458e",
    storageBucket: "qr-scanner-4458e.appspot.com",
    messagingSenderId: "1099262112748",
    appId: "1:1099262112748:web:a18f206bcf893c894546c9",
    measurementId: "G-15WXNEPKS9"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Scanner
  const html5QrCode = new Html5Qrcode("scanner");
  let currentZoom = 1;
  const maxZoom = 3;
  const minZoom = 0.5;
  const zoomStep = 0.25;

  const qrCodeSuccessCallback = (decodedText, decodedResult) => {
    // Save scan to Firestore
    db.collection("scans").add({
      value: decodedText,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
      const li = document.createElement("li");
      li.textContent = decodedText;
      document.getElementById("scan-list").appendChild(li);
    }).catch(err => console.error(err));
  };

  // Updated configuration
  const config = { 
    fps: 10, 
    qrbox: { width: 250, height: 250 },
    aspectRatio: 1.0,
    disableFlip: true
  };

  // Function to apply zoom
  function applyZoom() {
    const videoElement = document.querySelector('#scanner video');
    if (videoElement) {
      videoElement.style.transform = `scale(${currentZoom})`;
    }
  }

  // Start scanner
  html5QrCode.start(
    { facingMode: "environment" }, 
    config, 
    qrCodeSuccessCallback,
    (errorMessage) => {
      console.error(errorMessage);
    }
  ).then(() => {
    // Set up zoom controls after scanner starts
    document.getElementById('zoom-in').addEventListener('click', () => {
      if (currentZoom < maxZoom) {
        currentZoom += zoomStep;
        applyZoom();
      }
    });

    document.getElementById('zoom-out').addEventListener('click', () => {
      if (currentZoom > minZoom) {
        currentZoom -= zoomStep;
        applyZoom();
      }
    });
  }).catch(err => console.error(err));
</script>

</body>
</html>
