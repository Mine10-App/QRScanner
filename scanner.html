<!DOCTYPE html>
<html>
<head>
    <title>QR Scanner</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <!-- Firebase Libraries -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: Arial; text-align: center; margin: 0; padding: 0; }
        h1 { margin-top: 20px; }
        #reader {
            width: 80vw;     /* slightly bigger width */
            height: 50vh;    /* half the screen height */
            margin: 20px auto;
            border: 2px dashed #333;
            border-radius: 10px;
        }
        #list { list-style: none; padding: 0; }
        li { padding: 5px; border-bottom: 1px solid #ccc; }
    </style>
</head>
<body>

    <h1>QR Scanner</h1>
    <div id="reader"></div>
    <h3>Scanned Values</h3>
    <ul id="list"></ul>

    <script>
        // ===== Firebase Configuration =====
         const firebaseConfig = {
            apiKey: "AIzaSyC9FuNjWn8Up4JyjYbABEF2aNjO2bSXdfM",
            authDomain: "qr-scanner-4458e.firebaseapp.com",
            projectId: "qr-scanner-4458e",
            storageBucket: "qr-scanner-4458e.firebasestorage.app",
            messagingSenderId: "1099262112748",
            appId: "1:1099262112748:web:a18f206bcf893c894546c9",
            measurementId: "G-15WXNEPKS9"
        };


        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const ul = document.getElementById("list");

        // ===== Render scanned list =====
        function renderList(items) {
            ul.innerHTML = "";
            items.forEach(item => {
                let li = document.createElement("li");
                li.textContent = item.text + " - " + new Date(item.time).toLocaleString();
                ul.appendChild(li);
            });
        }

        // ===== Fetch scans from Firebase in real-time =====
        db.collection("scans").orderBy("time", "desc").onSnapshot(snapshot => {
            const items = [];
            snapshot.forEach(doc => {
                items.push(doc.data());
            });
            renderList(items);
        });

        // ===== On successful scan =====
        function onScanSuccess(decodedText) {
            // Save scan to Firebase
            db.collection("scans").add({
                text: decodedText,
                time: new Date()
            }).then(() => {
                console.log("Scan saved:", decodedText);
            }).catch(err => console.error(err));
        }

        // ===== Initialize QR scanner =====
        const html5QrCode = new Html5Qrcode("reader");
        html5QrCode.start(
            { facingMode: "environment" },
            { fps: 5, qrbox: { width: 300, height: 300 } }, // slightly bigger box
            onScanSuccess
        );
    </script>

</body>
</html>

