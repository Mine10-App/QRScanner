<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scan QR/Barcode via Photo</title>
  <script src="https://unpkg.com/@zxing/library@latest"></script>
</head>
<body style="text-align:center; font-family:sans-serif;">

<h2>Scan QR / Barcode</h2>

<input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none;">
<button onclick="document.getElementById('cameraInput').click()" 
        style="padding:15px 25px; font-size:18px;">
  Open Camera
</button>

<canvas id="canvas" style="display:none;"></canvas>
<p id="result" style="font-size:18px; color:green;"></p>

<script>
const input = document.getElementById('cameraInput');
const canvas = document.getElementById('canvas');
const resultElement = document.getElementById('result');

const codeReader = new ZXing.BrowserBarcodeReader();

input.addEventListener('change', async (event) => {
  if (event.target.files.length === 0) return;

  const file = event.target.files[0];
  const img = new Image();
  img.src = URL.createObjectURL(file);

  img.onload = async () => {
    // Resize image to max width/height 800px
    let maxDim = 800;
    let scale = Math.min(maxDim / img.width, maxDim / img.height, 1);
    canvas.width = img.width * scale;
    canvas.height = img.height * scale;

    const ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    try {
      const result = await codeReader.decodeFromCanvas(canvas);
      resultElement.textContent = "Scanned: " + result.text;
    } catch (err) {
      console.log(err);
      resultElement.textContent = "No QR or Barcode found. Try again!";
    }
  };
});
</script>

</body>
</html>
