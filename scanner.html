<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QR Scanner</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<style>
  body { margin: 0; font-family: Arial; text-align: center; }
  h1 { margin: 20px 0; }
  #reader {
    width: 95vw;       /* almost full screen width */
    height: 80vh;      /* large height for easy focus */
    margin: auto;
    border: 2px solid #333;
    border-radius: 10px;
  }
  #info { margin: 10px; font-size: 16px; color: green; }
</style>
</head>
<body>

<h1>QR Scanner</h1>
<div id="reader"></div>
<div id="info">Point your camera at a QR code</div>

<script>
  // ===== Firebase config =====
  const firebaseConfig = {
            apiKey: "AIzaSyC9FuNjWn8Up4JyjYbABEF2aNjO2bSXdfM",
            authDomain: "qr-scanner-4458e.firebaseapp.com",
            projectId: "qr-scanner-4458e",
            storageBucket: "qr-scanner-4458e.firebasestorage.app",
            messagingSenderId: "1099262112748",
            appId: "1:1099262112748:web:a18f206bcf893c894546c9",
            measurementId: "G-15WXNEPKS9"
        };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ===== Save scan =====
  const scanned = new Set();
  function saveScan(data) {
    if(scanned.has(data)) return; // prevent duplicates
    scanned.add(data);
    db.collection("scans").add({ text: data, time: new Date() })
      .then(() => document.getElementById("info").textContent = "Scanned: " + data)
      .catch(err => console.error(err));
  }

  // ===== On QR success =====
  function onScanSuccess(decodedText) {
    saveScan(decodedText);
  }

  // ===== Start scanner =====
  const html5QrCode = new Html5Qrcode("reader");
  html5QrCode.start(
    { facingMode: { exact: "environment" } },   // rear camera
    {
      fps: 10,
      qrbox: { width: 300, height: 300 }       // medium box = close focus
    },
    onScanSuccess
  ).catch(err => console.error(err));
</script>

</body>
</html>
