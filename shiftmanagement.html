<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shift Management</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f9; margin: 20px; }
    h2 { text-align: center; color: #333; }
    .shift-box { 
      border: 1px solid #ccc; 
      padding: 20px; 
      margin: 20px auto; 
      border-radius: 10px; 
      background: #fff; 
      max-width: 400px;
    }
    .shift-info { margin: 10px 0; font-weight: bold; }
    .open { color: green; }
    .closed { color: red; }
    button { 
      padding: 10px 20px; 
      margin: 5px; 
      border: none; 
      border-radius: 8px; 
      cursor: pointer; 
    }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .open-btn { background: #28a745; color: #fff; }
    .close-btn { background: #dc3545; color: #fff; }
    #currentShift { text-align: center; font-size: 18px; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>Shift Management</h2>

  <div class="shift-box">
    <h3>Shift 1 (Morning)</h3>
    <div id="shift1Status" class="shift-info closed">CLOSED</div>
    <div>Opened: <span id="shift1OpenTime">--</span></div>
    <div>Closed: <span id="shift1CloseTime">--</span></div>
    <div>Today: <span id="shift1Today">Not opened today</span></div>
    <button id="shift1OpenBtn" class="open-btn">Open Shift 1</button>
    <button id="shift1CloseBtn" class="close-btn" disabled>Close Shift 1</button>
  </div>

  <div class="shift-box">
    <h3>Shift 2 (Evening)</h3>
    <div id="shift2Status" class="shift-info closed">CLOSED</div>
    <div>Opened: <span id="shift2OpenTime">--</span></div>
    <div>Closed: <span id="shift2CloseTime">--</span></div>
    <div>Today: <span id="shift2Today">Not opened today</span></div>
    <button id="shift2OpenBtn" class="open-btn" disabled>Open Shift 2</button>
    <button id="shift2CloseBtn" class="close-btn" disabled>Close Shift 2</button>
  </div>

  <div id="currentShift">No shift active</div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // TODO: Replace with your Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // State object
    const state = {
      shifts: {
        shift1: { name: "Shift 1", open: false, openTime: null, closeTime: null, openedToday: false, closedToday: false },
        shift2: { name: "Shift 2", open: false, openTime: null, closeTime: null, openedToday: false, closedToday: false }
      }
    };

    // UI Elements
    const elements = {
      shift1Status: document.getElementById("shift1Status"),
      shift1OpenBtn: document.getElementById("shift1OpenBtn"),
      shift1CloseBtn: document.getElementById("shift1CloseBtn"),
      shift1OpenTime: document.getElementById("shift1OpenTime"),
      shift1CloseTime: document.getElementById("shift1CloseTime"),
      shift1Today: document.getElementById("shift1Today"),

      shift2Status: document.getElementById("shift2Status"),
      shift2OpenBtn: document.getElementById("shift2OpenBtn"),
      shift2CloseBtn: document.getElementById("shift2CloseBtn"),
      shift2OpenTime: document.getElementById("shift2OpenTime"),
      shift2CloseTime: document.getElementById("shift2CloseTime"),
      shift2Today: document.getElementById("shift2Today"),

      currentShift: document.getElementById("currentShift")
    };

    // Format time
    function formatTime(date) {
      return date ? new Date(date).toLocaleTimeString() : "--";
    }

    // Save shift to Firestore
    function saveShift(shiftId) {
      const shift = state.shifts[shiftId];
      db.collection("shifts").doc(shiftId).set({
        open: shift.open,
        openTime: shift.openTime ? shift.openTime.toISOString() : null,
        closeTime: shift.closeTime ? shift.closeTime.toISOString() : null,
        openedToday: shift.openedToday,
        closedToday: shift.closedToday
      });
    }

    // Open shift
    function openShift(shiftId) {
      if (shiftId === "shift2" && !state.shifts.shift1.closedToday) {
        alert("You must close Shift 1 before opening Shift 2.");
        return;
      }
      const shift = state.shifts[shiftId];
      if (shift.open) { alert(`${shift.name} already open`); return; }
      shift.open = true;
      shift.openTime = new Date();
      shift.openedToday = true;
      shift.closedToday = false;
      saveShift(shiftId);
    }

    // Close shift
    function closeShift(shiftId) {
      const shift = state.shifts[shiftId];
      if (!shift.open) { alert(`${shift.name} is not open`); return; }
      shift.open = false;
      shift.closeTime = new Date();
      shift.closedToday = true;
      saveShift(shiftId);
    }

    // Update UI
    function updateUI() {
      const s1 = state.shifts.shift1;
      const s2 = state.shifts.shift2;

      // Shift 1 UI
      elements.shift1Status.textContent = s1.open ? "OPEN" : "CLOSED";
      elements.shift1Status.className = "shift-info " + (s1.open ? "open" : "closed");
      elements.shift1OpenBtn.disabled = s1.open;
      elements.shift1CloseBtn.disabled = !s1.open;
      elements.shift1OpenTime.textContent = formatTime(s1.openTime);
      elements.shift1CloseTime.textContent = formatTime(s1.closeTime);
      elements.shift1Today.textContent = s1.openedToday ? (s1.closedToday ? "Opened and closed today" : "Opened today") : "Not opened today";

      // Shift 2 UI
      elements.shift2Status.textContent = s2.open ? "OPEN" : "CLOSED";
      elements.shift2Status.className = "shift-info " + (s2.open ? "open" : "closed");
      elements.shift2OpenBtn.disabled = !s1.closedToday || s2.open;
      elements.shift2CloseBtn.disabled = !s2.open;
      elements.shift2OpenTime.textContent = formatTime(s2.openTime);
      elements.shift2CloseTime.textContent = formatTime(s2.closeTime);
      elements.shift2Today.textContent = s2.openedToday ? (s2.closedToday ? "Opened and closed today" : "Opened today") : "Not opened today";

      // Current shift
      if (s1.open) {
        elements.currentShift.textContent = "Current shift: Shift 1 (Morning)";
      } else if (s2.open) {
        elements.currentShift.textContent = "Current shift: Shift 2 (Evening)";
      } else {
        elements.currentShift.textContent = "No shift active";
      }
    }

    // Realtime listener
    function listenToShifts() {
      db.collection("shifts").onSnapshot(snapshot => {
        snapshot.forEach(doc => {
          const data = doc.data();
          const shift = state.shifts[doc.id];
          if (shift) {
            shift.open = data.open;
            shift.openTime = data.openTime ? new Date(data.openTime) : null;
            shift.closeTime = data.closeTime ? new Date(data.closeTime) : null;
            shift.openedToday = data.openedToday;
            shift.closedToday = data.closedToday;
          }
        });
        updateUI();
      });
    }

    // Init
    function init() {
      elements.shift1OpenBtn.addEventListener("click", () => openShift("shift1"));
      elements.shift1CloseBtn.addEventListener("click", () => closeShift("shift1"));
      elements.shift2OpenBtn.addEventListener("click", () => openShift("shift2"));
      elements.shift2CloseBtn.addEventListener("click", () => closeShift("shift2"));

      listenToShifts();
      updateUI();
    }

    window.onload = init;
  </script>
</body>
</html>
